<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>
<!-- <script type="text/javascript">
    window.jsonpCallback = function (res) {
        console.log('res', res)
    }
</script> -->
<!-- src="http://localhost:8888/jsonp?cb=jsonpCallback"请求的结果就是
     jsonpCallback ({
"code": 0,
"message": "jsonp success"
})  -->
<!-- 相当于
<script>
    jsonpCallback(
        {
            "code": 0,
            "message": "jsonp success"
        }
    )
</script> -->
<!-- 直接执行了 -->
<!-- 而当前定义的是
window.jsonpCallback = function (res) {
    console.log('res', res)
} 

-->

<!-- 只能处理get请求 -->
<!-- <script src="http://localhost:8888/jsonp?cb=jsonpCallback"></script> -->


<!-- // 下面的代码是对上面的方式进行封装，使之更通用一些 -->
<script>
    function requestJSONP(url, data, jsonp = 'jsonpCallback') {
        return new Promise((resolve, reject) => {
            let arr = []

            Object.keys(data).forEach(key => {
                arr.push(`${key}=${data[key]}`)
            })

            let query = arr.join('&')
            const script = document.createElement('script')

            window[jsonp] = function (response) {
                document.body.removeChild(script)
                delete window[jsonp]
                resolve(response)
            }

            script.src = `${url}?${query}&cb=${jsonp}`
            document.body.appendChild(script)
        })
    }

    // 业务代码中
    requestJSONP('http://localhost:8888/jsonp', {
        data: 'Hello World'
    }, 'testJSONP').then(response => {
        console.log('JSONP', response)
    })
</script>

</html>